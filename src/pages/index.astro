---
import Layout from "../layouts/Layout.astro";

const PrimerPremio = "Auto 0km";
const SegundoPremio = "Otra cosa";

const logos = [
  { src: "/images/rsl.png", title: "Rally Sprint Latan" },
  { src: "/images/actc.png", title: "Asociación Corredores Turismo Carretera" },
  { src: "/images/planx5.png", title: "Plan X5 Argentina" },
];

// Generar un número único basado en un número de serie incremental
const generarNumeroUnico = () => {
  return 1234; // new Date();
};

const numeroCupon = generarNumeroUnico();
---

<Layout>
  <main class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
    <div
      class="max-w-5xl w-full bg-white rounded-lg shadow-lg flex flex-col md:flex-row border-4 border-dashed border-gray-400 relative"
    >
      <!-- Talón lateral para corte -->
      <div
        class="w-1/4 bg-gray-200 flex flex-col justify-between p-4 border-r border-dashed border-gray-400 text-center"
      >
        <h2 class="text-xl font-bold">Número</h2>
        <p id="numeroCupon" class="text-2xl font-extrabold text-gray-800">
          {numeroCupon}
        </p>
        <p class="text-sm text-gray-600">Conserva este cupón</p>
      </div>

      <!-- Contenido principal del cupón -->
      <div class="w-3/4 p-6 flex flex-col justify-between">
        <h1 class="text-3xl font-bold text-center text-black mb-4">
          Bono Contribución
        </h1>
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Formulario -->
          <div class="w-full md:w-1/2">
            <form
              id="sorteoForm"
              action="#"
              method="POST"
              class="space-y-2"
              onsubmit="handleSubmit(event)"
            >
              <div>
                <input
                  type="text"
                  id="Nombre"
                  name="Nombre"
                  required
                  placeholder="Nombre"
                  class="w-full p-1 border border-gray-300 rounded"
                />
              </div>
              <div>
                <input
                  type="text"
                  id="Apellido"
                  name="Apellido"
                  required
                  placeholder="Apellido"
                  class="w-full p-1 border border-gray-300 rounded"
                />
              </div>
              <div>
                <input
                  type="tel"
                  id="Telefono"
                  name="Telefono"
                  required
                  placeholder="Teléfono"
                  class="w-full p-1 border border-gray-300 rounded"
                />
              </div>
              <button
                type="submit"
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
              >
                Participar
              </button>
            </form>
          </div>

          <!-- Información de Premios y Logos -->
          <div class="w-full md:w-1/2 text-black">
            <h2 class="text-2xl font-bold mb-2">Premios</h2>
            <ul class="mb-4">
              <li>
                1º Premio: <span class="font-extrabold">{PrimerPremio}</span>
              </li>
              <li>
                2º Premio: <span class="font-extrabold">{SegundoPremio}</span>
              </li>
            </ul>
            <p class="text-sm mb-4">
              Sorteo el <strong>Fecha en formato largo</strong> en la premiación
              de la carrera.
            </p>
            <div class="flex space-x-4">
              {
                logos.map((logo) => (
                  <img
                    src={logo.src}
                    alt={logo.title}
                    class="w-16 h-auto"
                    title={logo.title}
                  />
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<!-- Script Enviar Formulario -->
<script is:inline>
  async function handleSubmit(event) {
    event.preventDefault();
    const form = document.getElementById("sorteoForm");
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.NumeroCupon = document.getElementById("numeroCupon").textContent;

    if (!data.Nombre || !data.Apellido || !data.Telefono) {
      alert("Por favor, complete todos los campos.");
      return;
    }

    try {
      const response = await fetch("/api/save.json", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      if (response.ok) {
        window.location.href = `/enviado?${new URLSearchParams(data).toString()}`;
      } else {
        alert("Error al guardar los datos");
      }
    } catch (error) {
      console.error(error);
      alert("Error al enviar el formulario");
    }
  }
</script>
